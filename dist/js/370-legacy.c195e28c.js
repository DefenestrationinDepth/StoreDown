"use strict";(self["webpackChunkstoredown"]=self["webpackChunkstoredown"]||[]).push([[370],{4661:function(t,e,a){a.d(e,{Z:function(){return g}});var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-layout",[a("v-flex",{attrs:{xs12:""}},[a("v-data-table",{attrs:{headers:t.headers,pagination:t.pagination,items:t.data.rows,loading:t.loading,"total-items":t.data.total_rows,"rows-per-page-items":[10,50,100,1e3]},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[a("ListColumnTypes",{attrs:{props:e,headers:t.headers,rowClick:t.rowClick}})]}},{key:"no-data",fn:function(){return[a("v-alert",{attrs:{value:!t.loading,color:"error"}},[t._v(" No data was found. ")])]},proxy:!0}])})],1)],1)},r=[],s=a(8560),n={components:{ListColumnTypes:s.Z},props:{headers:Array,rowClick:Function,loadData:Function},watch:{pagination:{handler(){this.getData()},deep:!0},$route(t,e){this.getData()}},data:()=>({pagination:{},loading:!1,data:{}}),methods:{getData:function(){this.loading=!0,this.data.rows=[];let t=(this.pagination.page-1)*this.pagination.rowsPerPage;this.loadData(t,this.pagination.rowsPerPage).then((t=>{this.data=t,this.loading=!1})).catch((t=>{404===t.status||this.$toasted.info(`Error ${t}`)}))}}},o=n,l=a(1001),h=a(3453),u=a.n(h),c=a(6965),d=a(848),p=a(683),f=a(9456),m=(0,l.Z)(o,i,r,!1,null,null,null),g=m.exports;u()(m,{VAlert:c.Z,VDataTable:d.Z,VFlex:p.Z,VLayout:f.Z})},5853:function(t,e,a){a.r(e),a.d(e,{default:function(){return _}});var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",{attrs:{"grid-list-lg":"",fluid:""}},[a("v-layout",[a("v-flex",{attrs:{xs12:""}},[t.$route.query.prefix?a("h5",{staticClass:"headline"},[a("button",{on:{click:function(e){return t.breadcrumbsClick(-1)}}},[t._v("Item tree")]),t._v(" / "),t._l(t.prefix,(function(e,i){return[a("button",{key:e,on:{click:function(e){return t.breadcrumbsClick(i)}}},[t._v(t._s(e))]),t._v(" / ")]}))],2):a("h4",{staticClass:"display-1"},[t._v("Item tree")])])],1),a("List",{attrs:{headers:t.headers,loadData:t.loadData,rowClick:t.rowClick}})],1)},r=[],s=a(8300),n=a(8955),o=a(4661);const l=1e4;var h={components:{List:o.Z},data:()=>({tree:{_items:[]},headers:[],pathField:!1,prefix:[]}),watch:{$route(t,e){}},mounted(){this.loadHeaders()},methods:{rowClick:function(t){return"item"===t.item.type?this.$router.push(`/entry/${t.item._id}`):this.$router.push({name:"tree",query:{prefix:`${this.$route.query.prefix||""}${t.item.name}/`}})},breadcrumbsClick:function(t){let e="";if(-1!==t&&(e=`${this.prefix.slice(0,t+1).join("/")}/`),e!==this.$route.query.prefix)return this.$router.push({name:"tree",query:{prefix:e}})},loadHeaders:function(){(0,n.Z)()&&s.E.getConfigObject().then((t=>{t.dataDefinition.forEach((t=>{t.fields.forEach((t=>{t.showInTree&&this.headers.push({text:t.displayName,value:t.name,align:"left",item:t,sortable:!1})}))}))})).catch((t=>{404===t.status||this.$toasted.info(`Error ${t}`)}))},loadData:function(t=0,e=100){this.prefix=(this.$route.query.prefix||"").slice(0,-1).toLowerCase().split("/");let a=t=>{let e=!1;return t.dataDefinition.forEach((t=>t.fields.forEach((t=>{"name"===t.name&&(e=!0),"path"===t.type&&(this.pathField=t)})))),e||(this.pathField=!1),this.pathField},i=()=>(this.$toasted.info("Building tree cache"),new Promise(((t,e)=>{s.E.getConfigObject().then((i=>{let r=0;if(!a(i))return e(new Error("Tree view not supported because a name field or field with type path is not set."));let s=this.pathField.name.charAt(0).toUpperCase()+this.pathField.name.slice(1),o=()=>{(0,n.Z)().getAllItems({skip:r,limit:l}).then((e=>(r+=e.rows.length||10,e.rows.forEach((t=>{let e=this.pathField.prefixes[(t[this.pathField.name]||"").toLowerCase()];e||(e="");let a="none";t[this.pathField.name]&&(a=`${e}${t[this.pathField.name]}`.toLowerCase()),"/"!==a.substr(-1)&&(a+="/"),a=a.slice(0,-1);let i=a.split("/"),r=this.tree;i.forEach((t=>{r[t]||(r[t]={_items:[]},r._items.unshift({name:t,type:"_path",_id:s})),r=r[t]})),r._items.push(t)})),r+10<e.total_rows?o():t(this.tree)))).catch(e)};return o()})).catch(e)}))),r=a=>{let i=this.tree;return a.forEach((t=>i[t]?i=i[t]:i._items)),{total_rows:i._items.length,rows:i._items.slice(t,t+e)}};return new Promise(((t,e)=>{if(this.tree._items.length)return t(r(this.prefix));i().then((()=>t(r(this.prefix))))}))}}},u=h,c=a(1001),d=a(3453),p=a.n(d),f=a(6530),m=a(683),g=a(9456),w=(0,c.Z)(u,i,r,!1,null,null,null),_=w.exports;p()(w,{VContainer:f.Z,VFlex:m.Z,VLayout:g.Z})}}]);
//# sourceMappingURL=370-legacy.c195e28c.js.map